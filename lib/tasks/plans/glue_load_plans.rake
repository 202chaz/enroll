namespace :seed do
  PLAN_MAPPINGS = {"43849DC0080001"=>"56377d4456696eddbcc11e01", "43849DC0090001"=>"56377d4456696eddbce01e01", "73987DC0040025-01"=>"56377d3156696eddbc99bb00", "73987DC0040001-01"=>"56377d3256696eddbc1cbc00", "73987DC0040035-01"=>"56377d3256696eddbc22bd00", "73987DC0040005-01"=>"56377d3256696eddbc28be00", "73987DC0040017-01"=>"56377d3256696eddbc2ebf00", "77422DC0070021-01"=>"56377d3256696eddbc34c000", "77422DC0070017-01"=>"56377d3256696eddbc3ac100", "73987DC0040029-01"=>"56377d3256696eddbc9fbc00", "73987DC0040046-01"=>"56377d3256696eddbca5bd00", "73987DC0040021-01"=>"56377d3256696eddbcabbe00", "73987DC0040034-01"=>"56377d3256696eddbcb1bf00", "77422DC0070001-01"=>"56377d3256696eddbcb7c000", "77422DC0070026-01"=>"56377d3256696eddbcbdc100", "95051DC0020005"=>"56377d3356696eddbc0dc500", "95051DC0020006"=>"56377d3356696eddbc2cc500", "77422DC0070035-01"=>"56377d3356696eddbc40c200", "77422DC0070013-01"=>"56377d3356696eddbc46c300", "78079DC0320001"=>"56377d3356696eddbc4bc500", "77422DC0070025-01"=>"56377d3356696eddbc4cc400", "78079DC0320002"=>"56377d3356696eddbc61c500", "78079DC0330001"=>"56377d3356696eddbc77c500", "78079DC0340001"=>"56377d3356696eddbc8dc500", "86052DC0400004-01"=>"56377d3356696eddbca3c500", "77422DC0070005-01"=>"56377d3356696eddbcc3c200", "77422DC0070009-01"=>"56377d3356696eddbcc9c300", "95051DC0020003"=>"56377d3356696eddbccfc400", "95051DC0020004"=>"56377d3356696eddbceec400", "86052DC0400003-01"=>"56377d3456696eddbc5fc800", "86052DC0400003-02"=>"56377d3456696eddbc60c800", "86052DC0400003-03"=>"56377d3456696eddbc61c800", "86052DC0400001-01"=>"56377d3456696eddbc66c600", "86052DC0400001-02"=>"56377d3456696eddbc67c600", "86052DC0400001-03"=>"56377d3456696eddbc68c600", "86052DC0400001-04"=>"56377d3456696eddbc69c600", "86052DC0400001-05"=>"56377d3456696eddbc6ac600", "86052DC0400001-06"=>"56377d3456696eddbc6bc600", "86052DC0400005-01"=>"56377d3456696eddbc9ec900", "86052DC0400005-02"=>"56377d3456696eddbc9fc900", "86052DC0400005-03"=>"56377d3456696eddbca0c900", "86052DC0400006-01"=>"56377d3456696eddbcddca00", "86052DC0400006-02"=>"56377d3456696eddbcdeca00", "86052DC0400006-03"=>"56377d3456696eddbcdfca00", "86052DC0400006-04"=>"56377d3456696eddbce0ca00", "86052DC0400006-05"=>"56377d3456696eddbce1ca00", "86052DC0400006-06"=>"56377d3456696eddbce2ca00", "86052DC0400009-01"=>"56377d3556696eddbc15ce00", "86052DC0400009-02"=>"56377d3556696eddbc16ce00", "86052DC0400009-03"=>"56377d3556696eddbc17ce00", "86052DC0400002-01"=>"56377d3556696eddbc54cf00", "86052DC0400002-02"=>"56377d3556696eddbc55cf00", "86052DC0400002-03"=>"56377d3556696eddbc56cf00", "86052DC0400008-01"=>"56377d3556696eddbc93d000", "86052DC0400008-02"=>"56377d3556696eddbc94d000", "86052DC0400008-03"=>"56377d3556696eddbc95d000", "78079DC0210002-01"=>"56377d3556696eddbcd2d100", "78079DC0210002-02"=>"56377d3556696eddbcd3d100", "78079DC0210002-03"=>"56377d3556696eddbcd4d100", "86052DC0400007-01"=>"56377d3556696eddbcd6cc00", "86052DC0400007-02"=>"56377d3556696eddbcd7cc00", "86052DC0400007-03"=>"56377d3556696eddbcd8cc00", "78079DC0210004-01"=>"56377d3656696eddbc15d300", "78079DC0210001-01"=>"56377d3656696eddbc15d500", "78079DC0210004-02"=>"56377d3656696eddbc16d300", "78079DC0210001-02"=>"56377d3656696eddbc16d500", "78079DC0210004-03"=>"56377d3656696eddbc17d300", "78079DC0210001-03"=>"56377d3656696eddbc17d500", "78079DC0210004-04"=>"56377d3656696eddbc18d300", "78079DC0210004-05"=>"56377d3656696eddbc19d300", "78079DC0210004-06"=>"56377d3656696eddbc1ad300", "78079DC0210003-01"=>"56377d3656696eddbc58d600", "78079DC0210003-02"=>"56377d3656696eddbc59d600", "78079DC0210003-03"=>"56377d3656696eddbc5ad600", "78079DC0160001-01"=>"56377d3656696eddbc9bd700", "78079DC0160001-02"=>"56377d3656696eddbc9cd700", "78079DC0160001-03"=>"56377d3656696eddbc9dd700", "86052DC0440011-01"=>"56377d3756696eddbc26dc00", "78079DC0170001-01"=>"56377d3756696eddbc59da00", "86052DC0440010-01"=>"56377d3756696eddbc63db00", "78079DC0160002-01"=>"56377d3756696eddbc9dd800", "78079DC0160002-02"=>"56377d3756696eddbc9ed800", "78079DC0160002-03"=>"56377d3756696eddbc9fd800", "78079DC0160002-04"=>"56377d3756696eddbca0d800", "78079DC0160002-05"=>"56377d3756696eddbca1d800", "78079DC0160002-06"=>"56377d3756696eddbca2d800", "78079DC0170002-01"=>"56377d3756696eddbcdeda00", "86052DC0440012-01"=>"56377d3756696eddbce9dc00", "86052DC0500009-01"=>"56377d3856696eddbc01e300", "86052DC0440015-01"=>"56377d3856696eddbc32df00", "86052DC0440019-01"=>"56377d3856696eddbc3ee200", "86052DC0440014-01"=>"56377d3856696eddbc6fde00", "86052DC0440018-01"=>"56377d3856696eddbc7be100", "86052DC0440013-01"=>"56377d3856696eddbcacdd00", "86052DC0440017-01"=>"56377d3856696eddbcb8e000", "86052DC0440016-01"=>"56377d3856696eddbcf5df00", "86052DC0500013-01"=>"56377d3956696eddbc0de600", "86052DC0500012-01"=>"56377d3956696eddbc4ae500", "86052DC0500011-01"=>"56377d3956696eddbc87e400", "86052DC0500015-01"=>"56377d3956696eddbc93e700", "86052DC0500010-01"=>"56377d3956696eddbcc4e300", "86052DC0500014-01"=>"56377d3956696eddbcd0e600", "86052DC0500017-01"=>"56377d3a56696eddbc19e900", "86052DC0460011-01"=>"56377d3a56696eddbc21ec00", "86052DC0500016-01"=>"56377d3a56696eddbc56e800", "86052DC0460010-01"=>"56377d3a56696eddbc60eb00", "86052DC0460009-01"=>"56377d3a56696eddbc9fea00", "86052DC0580001-01"=>"56377d3a56696eddbcdce900", "86052DC0460012-01"=>"56377d3a56696eddbce2ec00", "86052DC0460015-01"=>"56377d3b56696eddbc25ef00", "86052DC0460019-01"=>"56377d3b56696eddbc29f200", "86052DC0460014-01"=>"56377d3b56696eddbc64ee00", "81334DC0010004"=>"56377d3e56696eddbc160201", "86052DC0460018-01"=>"56377d3b56696eddbc68f100", "86052DC0460013-01"=>"56377d3b56696eddbca3ed00", "86052DC0460017-01"=>"56377d3b56696eddbca7f000", "86052DC0460016-01"=>"56377d3b56696eddbce6ef00", "86052DC0460020-01"=>"56377d3b56696eddbceaf200", "86052DC0480009-01"=>"56377d3c56696eddbc2df500", "86052DC0480013-01"=>"56377d3c56696eddbc31f800", "86052DC0480008-01"=>"56377d3c56696eddbc6cf400", "86052DC0480012-01"=>"56377d3c56696eddbc70f700", "86052DC0480007-01"=>"56377d3c56696eddbcabf300", "86052DC0480011-01"=>"56377d3c56696eddbcaff600", "86052DC0480010-01"=>"56377d3c56696eddbceef500", "78079DC0220023-01"=>"56377d3d56696eddbc3bfb00", "78079DC0220027-01"=>"56377d3d56696eddbc47fe00", "78079DC0220022-01"=>"56377d3d56696eddbc78fa00", "78079DC0220026-01"=>"56377d3d56696eddbc84fd00", "78079DC0220021-01"=>"56377d3d56696eddbcb5f900", "78079DC0220025-01"=>"56377d3d56696eddbcc1fc00", "78079DC0220020-01"=>"56377d3d56696eddbcf2f800", "78079DC0220024-01"=>"56377d3d56696eddbcfefb00", "78079DC0220028-01"=>"56377d3e56696eddbc0aff00", "81334DC0010006"=>"56377d3e56696eddbc350201", "81334DC0030004"=>"56377d3e56696eddbc520201", "78079DC0220031-01"=>"56377d3e56696eddbc530101", "81334DC0030006"=>"56377d3e56696eddbc730201", "78079DC0220030-01"=>"56377d3e56696eddbc900001", "81334DC0020004"=>"56377d3e56696eddbc940201", "81334DC0020006"=>"56377d3e56696eddbcb30201", "78079DC0220029-01"=>"56377d3e56696eddbccdff00", "81334DC0040004"=>"56377d3e56696eddbcd00201", "92479DC0040004"=>"56377d3f56696eddbc0a0401", "96156DC0010004"=>"56377d3f56696eddbc120301", "92479DC0040005"=>"56377d3f56696eddbc290401", "96156DC0010006"=>"56377d3f56696eddbc310301", "92479DC0030004"=>"56377d3f56696eddbc480401", "96156DC0020004"=>"56377d3f56696eddbc4e0301", "94506DC0390001-01"=>"56377d3f56696eddbc690401", "94506DC0390001-02"=>"56377d3f56696eddbc6a0401", "94506DC0390001-03"=>"56377d3f56696eddbc6b0401", "96156DC0020006"=>"56377d3f56696eddbc6d0301", "94506DC0390002-01"=>"56377d3f56696eddbc770501", "94506DC0390002-02"=>"56377d3f56696eddbc780501", "94506DC0390002-03"=>"56377d3f56696eddbc790501", "92479DC0020004"=>"56377d3f56696eddbc8a0301", "92479DC0020006"=>"56377d3f56696eddbca90301", "92479DC0010004"=>"56377d3f56696eddbcc80301", "92479DC0010006"=>"56377d3f56696eddbce90301", "81334DC0040006"=>"56377d3f56696eddbcf10201", "94506DC0390005-01"=>"56377d4056696eddbc750a01", "94506DC0390005-02"=>"56377d4056696eddbc760a01", "94506DC0390005-03"=>"56377d4056696eddbc770a01", "94506DC0390005-04"=>"56377d4056696eddbc780a01", "94506DC0390005-05"=>"56377d4056696eddbc790a01", "94506DC0390005-06"=>"56377d4056696eddbc7a0a01", "94506DC0390011-01"=>"56377d4056696eddbc850601", "94506DC0390011-02"=>"56377d4056696eddbc860601", "94506DC0390011-03"=>"56377d4056696eddbc870601", "94506DC0390003-01"=>"56377d4056696eddbc930701", "94506DC0390003-02"=>"56377d4056696eddbc940701", "94506DC0390003-03"=>"56377d4056696eddbc950701", "94506DC0390004-01"=>"56377d4056696eddbca10801", "94506DC0390004-02"=>"56377d4056696eddbca20801", "94506DC0390004-03"=>"56377d4056696eddbca30801", "94506DC0390004-04"=>"56377d4056696eddbca40801", "94506DC0390004-05"=>"56377d4056696eddbca50801", "94506DC0390004-06"=>"56377d4056696eddbca60801", "94506DC0390007-01"=>"56377d4156696eddbc1d0e01", "94506DC0390007-02"=>"56377d4156696eddbc1e0e01", "94506DC0390007-03"=>"56377d4156696eddbc1f0e01", "94506DC0390008-01"=>"56377d4156696eddbc2b0f01", "94506DC0390006-01"=>"56377d4156696eddbc490c01", "94506DC0390006-02"=>"56377d4156696eddbc4a0c01", "94506DC0390006-03"=>"56377d4156696eddbc4b0c01", "94506DC0390006-04"=>"56377d4156696eddbc4c0c01", "94506DC0390006-05"=>"56377d4156696eddbc4d0c01", "94506DC0390006-06"=>"56377d4156696eddbc4e0c01", "94506DC0390009-01"=>"56377d4156696eddbcb50f01", "94506DC0390009-02"=>"56377d4156696eddbcb60f01", "94506DC0390009-03"=>"56377d4156696eddbcb70f01", "94506DC0390010-01"=>"56377d4156696eddbcc31001", "94506DC0350021-01"=>"56377d4256696eddbc0d1501", "94506DC0350016-01"=>"56377d4256696eddbc5b1201", "94506DC0350018-01"=>"56377d4256696eddbc6f1301", "94506DC0350017-01"=>"56377d4256696eddbc831401", "94506DC0350022-01"=>"56377d4256696eddbc971501", "94506DC0390010-02"=>"56377d4256696eddbcc41001", "94506DC0390010-03"=>"56377d4256696eddbcc51001", "94506DC0350001-01"=>"56377d4256696eddbcd11101", "94506DC0350004-01"=>"56377d4256696eddbce51201", "94506DC0350002-01"=>"56377d4256696eddbcf91301", "94506DC0350005-01"=>"56377d4356696eddbc211601", "94506DC0350008-01"=>"56377d4356696eddbc351701", "94506DC0350006-01"=>"56377d4356696eddbc491801", "94506DC0350007-01"=>"56377d4356696eddbc5d1901", "94506DC0350011-01"=>"56377d4356696eddbc711a01", "94506DC0350019-01"=>"56377d4356696eddbcab1601", "94506DC0350009-01"=>"56377d4356696eddbcbf1701", "94506DC0350020-01"=>"56377d4356696eddbcd31801", "94506DC0350010-01"=>"56377d4356696eddbce71901", "94506DC0350012-01"=>"56377d4456696eddbc0f1c01", "94506DC0350013-01"=>"56377d4456696eddbc231d01", "94506DC0360001-01"=>"56377d4456696eddbc371e01", "94506DC0360002-01"=>"56377d4456696eddbc851b01", "94506DC0350015-01"=>"56377d4456696eddbc991c01", "94506DC0350014-01"=>"56377d4456696eddbcad1d01", "94506DC0360003-01"=>"56377d4456696eddbcfb1a01", "21066DC0010009-01"=>"56377d4556696eddbc2e2301", "75753DC0010030-01"=>"56377d4556696eddbc312001", "75753DC0010056-01"=>"56377d4556696eddbc632101", "75753DC0010058-01"=>"56377d4556696eddbc952201", "75753DC0010067-01"=>"56377d4556696eddbc981f01", "21066DC0010010-01"=>"56377d4556696eddbcc72301", "75753DC0010042-01"=>"56377d4556696eddbcca2001", "75753DC0010057-01"=>"56377d4556696eddbcfc2101", "75753DC0010066-01"=>"56377d4556696eddbcff1e01", "21066DC0010016-01"=>"56377d4656696eddbc2b2601", "41842DC0040046-01"=>"56377d4656696eddbc5d2701", "21066DC0010011-01"=>"56377d4656696eddbc602401", "21066DC0010015-01"=>"56377d4656696eddbc922501", "41842DC0040024-01"=>"56377d4656696eddbcc42601", "41842DC0040047-01"=>"56377d4656696eddbcf62701", "21066DC0010014-01"=>"56377d4656696eddbcf92401", "41842DC0010069-01"=>"56377d4756696eddbc252c01", "41842DC0010004-01"=>"56377d4756696eddbc282901", "41842DC0010072-01"=>"56377d4756696eddbc572d01", "41842DC0010008-01"=>"56377d4756696eddbc5a2a01", "41842DC0010043-01"=>"56377d4756696eddbc8c2b01", "41842DC0040050-01"=>"56377d4756696eddbc8f2801", "41842DC0010001-01"=>"56377d4756696eddbcbe2c01", "41842DC0010006-01"=>"56377d4756696eddbcc12901", "41842DC0010012-01"=>"56377d4756696eddbcf32a01", "41842DC0010032-01"=>"56377d4856696eddbc222f01", "41842DC0010054-01"=>"56377d4856696eddbc543001", "41842DC0010060-01"=>"56377d4856696eddbc863101", "41842DC0010074-01"=>"56377d4856696eddbc892e01", "41842DC0010042-01"=>"56377d4856696eddbcbb2f01", "41842DC0010056-01"=>"56377d4856696eddbced3001", "41842DC0010073-01"=>"56377d4856696eddbcf02d01", "41842DC0040045-01"=>"56377d4956696eddbc1c3501", "41842DC0010066-01"=>"56377d4956696eddbc1f3201", "41842DC0040099-01"=>"56377d4956696eddbc4e3601", "41842DC0010031-01"=>"56377d4956696eddbc513301", "41842DC0010068-01"=>"56377d4956696eddbc833401", "41842DC0040091-01"=>"56377d4956696eddbcb53501", "41842DC0010030-01"=>"56377d4956696eddbcb83201", "41842DC0040101-01"=>"56377d4956696eddbce73601", "41842DC0010067-01"=>"56377d4956696eddbcea3301"}
  task :load_plans, [:year] => :environment do |task, args|
    binding.pry

    def build_premium_tables(premium_tables)
      results = premium_tables
      premium_tables.select{|pm| pm[:age] == 20 }.each do |pt|
        (0..19).each do |age_number|
          results << {age: age_number, rate_start_date: pt[:rate_start_date], rate_end_date: pt[:rate_end_date], amount: pt[:amount]}
        end
      end
      premium_tables.select{|pm| pm[:age] == 65 }.each do |pt|
        (66..120).each do |age_number|
          results << {age: age_number, rate_start_date: pt[:rate_start_date], rate_end_date: pt[:rate_end_date], amount: pt[:amount]}
        end
      end
      results
    end
    def dump_plan_for_enroll(plan)
      plan_json = {
        :id => plan.id.to_s,
        :name => plan.name,
        :hios_plan_id => plan.hios_id,
        :hios_base_id => plan.hios_base_id,
        :csr_variant_id => plan.csr_variant_id,
        :ehb => plan.ehb.nil? ? "0.0" : plan.ehb.to_s,
        :year => plan.active_year,
        :carrier_id => plan.carrier_profile_id.to_s,
        :metal_level => plan.metal_level,
        :coverage_type => plan.coverage_kind,
        :renewal_plan_id => plan.renewal_plan_id.present? ? PLAN_MAPPINGS[plan.renewal_plan.hios_id] : nil,
        :minimum_age => 0,
        :maximum_age => 120,
        :market_type => plan.market
      }
      premium_tables = []
      # t =  build_premium_tables(plan.premium_tables)
      plan.premium_tables.each do |pt|
        if (pt.age < 67) && (pt.age > 18)
          premium_tables << {
            :age => pt.age,
            :rate_start_date => pt.start_on,
            :rate_end_date => pt.end_on,
            :amount => pt.cost
          }
        end
      end
      puts JSON.dump(plan_json.merge({:premium_tables => build_premium_tables(premium_tables).uniq}))
    end
    puts "["
    Plan.where(active_year: args[:year]).each do |pln|
      dump_plan_for_enroll(pln)
      puts(",")
    end
    puts "]"
  end
end