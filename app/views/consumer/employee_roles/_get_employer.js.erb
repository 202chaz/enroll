$('#new_person_wrapper').html("<%= escape_javascript(render "person_form") %>");
$('#employer-info').html("<%= escape_javascript(render 'employers').html_safe %>");

$('#search-employer').hide();
$('#personal_info').addClass('personal-info-top-row');
$('#personal_info').removeClass('personal-info-row');
$("#key-section").removeClass("hidden");
$('.search-btn-row').addClass('hidden');
$('#employer-info').removeClass('hidden');
$('#address_info').removeClass('hidden');
$('#phone_info').removeClass('hidden');
$('#email_info').removeClass('hidden');
$('.search_continue').removeClass('hidden');
$("#employer-info").css("display", "block");
$("#person_id").val("<%= @person.id %>");

var index = 0;
<% @person.addresses.each do |address| %>
  $("#person_addresses_attributes_"+index+"_address_1").val("<%= address.address_1 %>");
  $("#person_addresses_attributes_"+index+"_address_2").val("<%= address.address_2 %>");
  $("#person_addresses_attributes_"+index+"_city").val("<%= address.city %>");
  $("#person_addresses_attributes_"+index+"_state").val("<%= address.state %>");
  $("#person_addresses_attributes_"+index+"_zip").val("<%= address.zip %>");
  $("#person_addresses_attributes_"+index+"_kind").val("<%= address.kind %>");
  index = index+1;
<% end %>

var index = 0;
<% @person.phones.each do |phone| %>
  $("#person_phones_attributes_"+index+"_full_phone_number").val("<%= phone.full_phone_number %>");
  $("#person_phones_attributes_"+index+"_kind").val("<%= phone.kind %>");
  index = index+1;
<% end %>

var index = 0;
<% @person.emails.each do |email| %>
  $("#person_emails_attributes_"+index+"_address").val("<%= email.address %>");
  $("#person_emails_attributes_"+index+"_kind").val("<%= email.kind %>");
  index = index+1;
<% end %>


var personal_entry = check_personal_entry_progress();
var address_entry  = check_address_entry_progress();
var phone_entry    = check_phone_entry_progress();
var email_entry    = check_email_entry_progress();

if(personal_entry) {
  start_progress = 10;
  $("a.one, a.two").css("color","#00b420");
}

if(address_entry) {
  start_progress += 8;
  $("a.three").css("color","#00b420");
}

if(phone_entry) {
  start_progress += 10;
  $("a.four").css("color","#00b420");
}

if(email_entry) {
  start_progress += 12;
  $("a.five").css("color","#00b420");
}

$('#top-pad').html(start_progress + '% Complete');
$('.progress-top').css('height', start_progress + '%');

if(start_progress >= 40) {
  $('#continue-employer').removeClass('disabled');
} else {
  $('#continue-employer').addClass('disabled');
}

function check_personal_entry_progress() {
  gender_checked = $("#person_gender_male").prop("checked") || $("#person_gender_female").prop("checked");
  if(gender_checked==undefined) {
    return true;
  }
  if(check_personal_info_exists().length==0 && gender_checked) {
    return true;
  } else {
    $("a.one").css('color', '#999'); $("a.two").css('color', '#999');
    return false;
  }
}

function check_address_entry_progress() {
  var empty_address = $('#address_info input.required').filter(function() { return $(this).val() === ""; }).length;
  if(empty_address === 0) { return true; }
  else {
    $("a.three").css('color', '#999');
    return false;
  }
}

function check_phone_entry_progress() {
  var empty_phone = $('#phone_info input.required').filter(function() { return ($(this).val() === "" || $(this).val() === "(___) ___-____"); }).length;
  if(empty_phone === 0) { return true; }
  else {
    $("a.four").css('color', '#999');
    return false;
  }
}

function check_email_entry_progress() {
  var empty_email = $('#email_info input.required').filter(function() { return $(this).val() === ""; }).length;
  if(empty_email === 0) { return true; }
  else {
    $("a.five").css('color', '#999');
    return false;
  }
}