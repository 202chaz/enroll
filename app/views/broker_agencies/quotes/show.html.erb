<div class="module container broker_quote_tool" style="border: 1; solid">
  <br> <br>
  <h2>Quote Calculator</h2>
  <div  role="tab" id="feature-mgmt-header">
    <a role="button" data-toggle="collapse" data-parent="#accordion" href="#quote-benefit-group-mgmt">
      <b>Quote Benefit Group Selection</b>
    </a>
  </div>
  <br>
  <div id="quote-roster" data-url="<%= broker_agencies_broker_role_quote_path(broker_role_id: @broker.id,id: @q.id, section: true)%>">
    <% @benefit_groups.each_with_index do |benefit_group, index| %>
    <% if index == 0 %>
    <% @first_quote = benefit_group.title %>
    <h3><%= benefit_group.title%></h3>
    <section>
      <div id='first_div'>
        <%= render partial: 'quote_calculate', locals: {benefit_group: benefit_group }%>
      </div>
    </section>
    <% else %>
    <h3><%= benefit_group.title %></h3>
    <section>
      <div id='second_div'>
        <%#= render partial: 'quote_calculate', locals: {benefit_group: benefit_group}%>
      </div>
    </section>
  </div>

  <% end %>
  <% end %>

</div>
</div>


<script type="text/javascript">

  $(document).on('ready page:load', function () {
    QuotePageLoad.set_select_health_plans(<%=raw @health_plan_quote_criteria %>)
    Quote.show_benefit_group("<%= @q.id%>", "<%= @quote_benefit_group.id%>")

  });

  $("#quote-roster").steps({
    headerTag: "h3",
    bodyTag: "section",
    transitionEffect: "slideLeft",
    enableAllSteps: true,
    autoFocus: true,
    onStepChanged: function (event, currentIndex, newIndex)
    {
      if(currentIndex == 1){
        $.ajax({
          type: "GET",
          url: $("#quote-roster").data('url'),
          data: {
            broker_role_id: "<%= @broker.id %>",
            id: "<%= @q.id %>",
            section: true
          }
        });
      }else{
        location.reload();
      }
    }
  });

// $('.actions').hide()
$('ul li.last').addClass('done')
</script>
