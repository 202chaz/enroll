<div class="module container broker_quote_tool" style="border: 1; solid">
  <br> <br>
  <h2>Quote Calculator</h2>
  <div  role="tab" id="feature-mgmt-header" style="margin-left: 10px;">
    <a role="button" data-toggle="collapse" data-parent="#accordion" href="#quote-benefit-group-mgmt">
    <b>Quote Benefit Group Selection</b>
    </a>
    <div style="margin-left: 15px;">
    <h4>Employers can set up different benefit groups, which allow for different plan offerings, reference plan, and contributions. Employees must be assigned to different benefit packages according to legally permissible employment classification (for example, employees located at different worksites, or part-time and full-time employees, etc.)</h4>
  </div>
  </div>
  <div id="quote-roster" data-url="<%= broker_agencies_broker_role_quote_path(broker_role_id: @broker.id,id: @q.id, section: true)%>">
    <% @benefit_groups.each_with_index do |benefit_group, index| %>
    <% if index == 0 %>
    <h3><%= benefit_group.title%></h3>
    <section>
      <div class="step_section_<%= index%>">
        <%= render partial: 'quote_calculate', locals: {benefit_group: benefit_group }%>
      </div>
    </section>
    <% else %>
    <h3><%= benefit_group.title %></h3>
    <section>
      <div id='second_div' class="step_section_<%= index%>">
      </div>
    </section>
    <% end %>
    <% end %>
  </div>
</div>

<script type="text/javascript">

  $(document).on('ready page:load', function () {
    QuotePageLoad.set_select_health_plans(<%=raw @health_plan_quote_criteria %>)
    Quote.show_benefit_group("<%= @q.id%>", "<%= @quote_benefit_group.id%>")
  });

  $("#quote-roster").steps({
    headerTag: "h3",
    bodyTag: "section",
    transitionEffect: "slideLeft",
    enableAllSteps: true,
    autoFocus: true,
    onStepChanged: function (event, currentIndex, newIndex)
    {

      $.ajax({
        type: "GET",
        url: $("#quote-roster").data('url'),
        data: {
          broker_role_id: "<%= @broker.id %>",
          id: "<%= @q.id %>",
          section: true,
          row: currentIndex
        }
      });
    }
  });

  $("li[role='tab']").each(function( index ) {
    if (!$(this).hasClass('first')){
      $( this ).addClass('done');
    }
  });

</script>
