<% broker = 'Nothing' %>
<% general_agency = 'Nothing' %>

<%
if employer_datatable_entry.active_broker_agency_account.present? && employer_datatable_entry.memoize_active_broker(@memo)
        broker_agency_profile = employer_datatable_entry.active_broker_agency_account.broker_agency_profile
        edit_path = edit_broker_agencies_profile_applicant_path(broker_agency_profile, employer_datatable_entry.memoize_active_broker(@memo))
        broker = link_to employer_datatable_entry.memoize_active_broker(@memo).full_name, edit_path, class: "interaction-click-control-broker-show", method: :get
end
%>

<%
      if employer_datatable_entry.active_general_agency_account.present?
        ga_legal_name = employer_datatable_entry.hashed_active_general_agency_legal_name(@general_agency_profiles)
        clear_assign_path = pundit_span(EmployerProfile, :updateable?)  + link_to(' clear assign', clear_assign_for_employer_broker_agencies_profile_path(id: @broker_agency_profile.id, employer_id: employer_datatable_entry.id), method: :post, remote: true)
        general_agency = ga_legal_name + clear_assign_path
      end
%>

<% effective_date = employer_datatable_entry.published_plan_year.try(:effective_date).to_s + view_context.pundit_span(EmployerProfile, :list_enrollments?) + view_context.link_to(' (Review)', employers_premium_statement_path(er)) %>

<% checkbox_column = capture do %>
  <%= check_box_tag "employer_ids[]", employer_datatable_entry.id, :id => "broker_dt_employer_ids_#{employer_datable_entry.id}" %>
<% end %>

{
  "nothing": <%= checkbox_column.to_json %>,
  "fein": <%= employer_datatable_entry.fein.to_json %>, 
  "legal_name" : <%= employer_datatable_entry.legal_name.to_json %>, 
  "ee_count": <%= employer_datatable_entry.roster_size.to_i.to_json %>,
  "er_state": <%= employer_datatable_entry.aasm_state.humanize.to_json %>,
  "broker": <%= broker.to_json %>,
  "general_agency": <%= general_agency.to_json %>,
  "effective_date": <%= effective_date.to_json %>
}
