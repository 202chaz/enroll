<% #if missing_relationships.present?%>
  <h1 class="darkblue">Family Relationships</h1>
  <p>We need to understand how members of your household are related. Select the relationship for each person listed below. Then select CONTINUE.</p>
  <%= form_tag "/insured/family_relationships", remote: form_remote do %>
    <%= hidden_field_tag :family_id, family.id%>

    <%= hidden_field_tag :consumer_role_id, params[:consumer_role_id]%>
    <%= hidden_field_tag :resident_role_id, params[:resident_role_id]%>
    <%= hidden_field_tag :employee_role_id, params[:employee_role_id]%>
    <%= hidden_field_tag :redirect_url, redirect_url%>

<% # script not updated for iterated values .... below script is saving only when iterator is not present%>
        <% all_relationships.each do |er| %>
            <% #er = existing_relationships.first %>
            <div class="household">
              <div class="usercard">
                <div class="row card-detail-titles">
                  <div class="col-lg-3">Name</div>
                  <div class="col-lg-5">Relationship *</div>
                  <div class="col-lg-4">Household Member</div>
                </div>
                <div class="row">
                  <%= hidden_field_tag 'predecessor_id', er[:predecessor] %>
                  <%= hidden_field_tag "successor_id", er[:successor] %>
                  <div class="col-lg-3"><%= member_name_by_id(er[:predecessor]) %></div>
                  <div class="col-lg-5">
                    <div class="select-positioning"> is</div>
                    <div class="select-relation rs_selection">
                      <%= select_tag :kind, er[:relation].present? ? options_for_select(humanize_relationships, er[:relation]) : options_for_select(humanize_relationships), {include_blank: true, required: true, id: 'selected_relationship'} %>
                    </div>
                    <div style="float:left; margin-right: 10px;"> of</div>
                    <div class="icon-rel">
                      <i class="fa fa-user icn-out fa-2x" aria-hidden="true"></i>
                      <i class="fa fa-link" aria-hidden="true"></i>
                      <i class="fa fa-user icn-out fa-lg" aria-hidden="true"></i>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <%= member_name_by_id(er[:successor]) %>
                  </div>
                </div>
              </div>
            </div>
            <br/>

        <% end %>

        <%# TODO move script to relationship_selectior.js %>
        <script>
            $('#selected_relationship').change(function () {
                $.ajax({
                    url: "/insured/family_relationships",
                    method: "POST",
                    dataType: 'script',
                    data: {
                        "kind": $("#selected_relationship option:selected").val() ,
                        "predecessor_id":  $("#predecessor_id").val(),
                        "successor_id": $("#successor_id").val()
                    }
                })
            });

        </script>

    <%= submit_tag "", class: "" %>

  <% end %>
<%#else%>

<% # TODO REMOVE ,,,, BELOW MATRIX IS FOR TESTING PURPOSE %>
  <h1 class="darkblue">Household Relationships</h1>
  <div>
    <h4>All the relationships are added. Please continue.</h4>
    <% if params[:consumer_role_id].present? || params[:employee_role_id].present? || params[:resident_role_id].present?%>
      <h4> Please click continue to proceed.</h4>
    <% end %>
  </div>
  <br />
  <div>
    <table id="relationship-matrix">
      <thead>
        <th></th>
        <%@people.each do |person|%>
          <th><%=person.full_name%></th>
        <%end%>
      </thead>
      <tbody>
        <%@matrix.each_with_index do |relationships_row, index_x|%>
          <tr>
            <td><b><%=@people[index_x].full_name%></b></td>
            <%relationships_row.each_with_index do |rel, index_y|%>
              <td><small><%= rel.titleize if rel.present?%></small></td>
            <%end%>
          </tr>
        <%end%>
      </tbody>
    </table>
  </div>
<%#end%>

