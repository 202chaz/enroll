<div class="container bottom-pd">
  <div class="row">
    <h4 class="title-inline">Editing APTC / CSR for:</h4>
  </div>
  <div>
    <table class="table table-border">
      <thead>
        <th>HBX ID</th>
        <th>Name</th>
        <th>DOB</th>
        <th>SSN</th>
      </thead>
      <tbody>
        <tr>
          <td><%=@person.hbx_id%></tb>
          <td><%=@person.first_name%> <%#=@person.last_name%></td>
          <td><%#=@person.dob%></td>
          <td><%#=@person.ssn%></td>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="row input-no-pd">
    <%= form_for @person, remote: true, url: update_aptc_csr_path, method: "post", class: "form" do |f|%>
      <%= f.hidden_field :person_id, value: @person.id %>
      <%= f.hidden_field :family_id, value: @family.id %>
       <div align="center"> <%= link_to 'Calculate Available APTC', edit_aptc_csr_path(family_id: @family.id, person_id: @person.id), class: "btn btn-default btn", remote: true%></div><br/>
      <table class="table table-border">
        
        <thead>
          <th>Month (2016)</th>
          <% @grid_vals.first[1].each do |key, val| %>
            <th><%=key.capitalize%></th>
          <%end%>
          <th> </th>
          <th>Edit Fields</th>
        </thead>  
        <tbody>
            <%@grid_vals.keys.each do |key_hdr|%>
              <tr>
                  <%if key_hdr != "individuals_covered" && key_hdr != "eligible_members"%>
                      <td><%=key_hdr.titleize.upcase%></td>
                  
                      <% @grid_vals[key_hdr].each do |key, val| %>
                          <%if key_hdr != "individuals_covered"%>
                            <td> <%= text_field_tag "#{key_hdr.to_s+"_"+key.to_s}", val, placeholder: '', class: 'form-control', readonly: true, disabled: true%></td>
                          <%end%> 
                      <%end%>
                      <td></td>
                      <td>
                          <%if key_hdr == "aptc_applied"%> 
                              <%= text_field_tag "#{key_hdr.to_s}", @aptc_applied, placeholder: key_hdr.titleize.upcase, size: '8px', hidden: !['max_aptc', 'csr_percentage', 'aptc_applied'].include?(key_hdr), disabled: !['max_aptc', 'csr_percentage', 'aptc_applied'].include?(key_hdr)%>
                          <%elsif key_hdr == "max_aptc"%>
                              <%= text_field_tag "#{key_hdr.to_s}", @max_aptc, placeholder: key_hdr.titleize.upcase, size: '8px', hidden: !['max_aptc', 'csr_percentage', 'aptc_applied'].include?(key_hdr), disabled: !['max_aptc', 'csr_percentage', 'aptc_applied'].include?(key_hdr)%>
                          <%elsif key_hdr == "csr_percentage"%>
                              <%= text_field_tag "#{key_hdr.to_s}", @csr_percent_as_integer, placeholder: key_hdr.titleize.upcase, size: '8px', hidden: !['max_aptc', 'csr_percentage', 'aptc_applied'].include?(key_hdr), disabled: !['max_aptc', 'csr_percentage', 'aptc_applied'].include?(key_hdr)%>
                          <%end%> 
                      </td>
                  <%end%>
              </tr>
              <tr></tr>
            <%end%>         

                <tr>
                  <th>Individual(s) Covered</th>
                  <% @grid_vals.first[1].each do |key, val| %>
                    <th><%=key.capitalize%></th>
                  <%end%>
                  <th></th>
                  <th>Eligible?</th>
                </tr>
                <% @grid_vals["individuals_covered"].each do |one_ind| %> <!--this "val" is a hash of {"month" => value}-->
                  <tr>
                    <td><%=one_ind.keys.first%></td>
                      <%one_ind.values.first.each do |key, val|%> <!--(month and value)-->
                        <td><%=check_box_tag "#{one_ind.keys.first.to_s+'_'+key.to_s}", 'checked', val, disabled: true%></td>
                      <%end%>
                      <td></td>
                      <td><%=check_box_tag "#{one_ind.keys.first.to_s}", 'accepted', (@grid_vals["eligible_members"].include? one_ind.keys.first.to_s), disabled: false%></td>
                  </tr>
                <%end%>

        </tbody> 
      </table>
      <div align="right"><%= f.submit "Confirm", class: "btn btn-primary btn-lg" %></div>
    <% end %>
  </div>
</div>