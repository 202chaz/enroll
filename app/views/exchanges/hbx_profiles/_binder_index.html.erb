<div class='container'>
  <div class="row">
    <h3 class="title-inline">Binder Transition Information</h3>
  </div>
</div>

<%= form_tag binder_paid_exchanges_hbx_profiles_path, method: :post, id: 'binder_paid_index' do %>
  <div class="module">
    <table id="binder-transition-dataTable" class="table table-striped table-hover table-sm display select">
      <thead class="thead-default">
        <tr>
         <th>
            <%= check_box_tag "checkall" %> &nbsp; &nbsp;Select All
         </th>
         <th>Name</th>
         <th>Status</th>
         <th>Employer Type</th>
         <th>Eligibility Criteria</th>
         <th></th>
        </tr>
      </thead>
      <tbody>
        <% @employers.each do |employer| %>
          <% if employer.is_new_employer? || employer.is_renewing_employer? %>
            <tr>
              <td>
                <% if employer.aasm_state != "binder_paid" %>
                  <%= check_box_tag("employer_profile_ids[]", employer.id, nil, id: "employer_profile_id_#{employer.id.to_s}", disabled: make_binder_checkbox_disabled(employer), class: "binderCheckBox") %>
                <% end %>
              </td>
              <td><%= employer.legal_name %></td>
              <td><%= employer.aasm_state.titleize %></td>
              <td><%= employer.renewing_plan_year.present? ? "Renewing" : "New" %></td>
              <td class="eligibility-rule">
                <%= eligibility_criteria(employer) %>
              </td>
              <td>
                <% if employer.aasm_state == "binder_paid" %>
                  <%= link_to('Transmit XML', transmit_group_xml_exchanges_hbx_profile_path(employer), method: :post, class: "btn btn-primary transmit-group-xml" , data: { confirm: 'Are you sure you want to transmit the xml?'}) %>
                <% end %>
              </td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>
  <%= submit_tag "Binder Paid", class: 'btn btn-primary', id: "binderSubmit" %>
<% end %>

<script type="text/javascript">

  $(document).ready(function(){

    var table = $("#binder-transition-dataTable").DataTable({
      "iDisplayLength": 10
    });

    var checkBoxes = $('tbody .binderCheckBox');
    var headCheckBox = $('thead #checkall');

    $('tbody .binderCheckBox, thead #checkall').change(function () {
      var selectedCheckBoxes = checkBoxes.filter(':checked');
      var disabledCheckBoxes = checkBoxes.filter(':disabled');
      var enabledCheckBoxes = checkBoxes.filter(':enabled');
      var selectedDisabledCheckBoxes = checkBoxes.filter(":checked").filter(":disabled");
      var selectedDisabledCheckBoxesLength = selectedDisabledCheckBoxes.length;
      var selectedCheckBoxesLength = selectedCheckBoxes.length;
      var disabledCheckBoxesLength = disabledCheckBoxes.length;
      var enabledCheckBoxesLength = enabledCheckBoxes.length;
      var totalCheckBoxesLength = checkBoxes.length;

      checkBoxes.filter(':checked').filter(":disabled").prop("checked", false);
      if(selectedCheckBoxesLength < 1 || (selectedDisabledCheckBoxesLength == totalCheckBoxesLength)){
        $('#binderSubmit').prop('disabled', true);
      }else if(selectedCheckBoxesLength >= 1 ){
        $('#binderSubmit').prop('disabled', false);
      }

      if (selectedCheckBoxesLength != 0 && totalCheckBoxesLength != selectedCheckBoxesLength){
        headCheckBox.prop("indeterminate", true);
      }else if (totalCheckBoxesLength == selectedCheckBoxesLength){
        headCheckBox.prop({'indeterminate': false, 'checked': true });
      }else if(selectedCheckBoxesLength == 0){
        headCheckBox.prop({'indeterminate': false, 'checked': false });
      }else{
          headCheckBox.prop({'indeterminate': true, 'checked': false });
      }
    });

    $('#checkall').click(function () {
      $(':checkbox', table.rows().nodes()).prop('checked', this.checked);
    });

    checkBoxes.change();

  });
</script>