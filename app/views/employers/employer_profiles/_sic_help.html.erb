<!-- SIC codes helper -->
<div id="sicHelperModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Search for your matching SIC Code</h4>
        <p>SIC (Standard Industrial Classifications) codes are used to categorize your business into the appropriate rating group</p>
        <p>You can use browse or search through all the available codes -- double click to make a selection</p>
        <input id="sic_search" type="text" value="" alt="Provide a keyword related to your business"/>
      </div>
      <div class="modal-body" id="sictree">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- SIC codes helper -->

<script type="text/javascript">
  $(function() {
    $.ajax({
      async: true,
      type: "GET",
      url: "/employers/employer_profiles/generate_sic_tree",
      dataType: "json",
      success: function(json) {
        createJSTrees(json);
      }
    });
  });

  function createJSTrees(jsonData) {
    $("#sictree").on( 'click',
                      '.jstree-anchor',
                      function (e) {
                        $('#sictree').jstree(true).toggle_node(e.target);
                      }).jstree({
                          'core' : {
                            'data' : jsonData,
                            'dblclick_toggle' : false
                          },
                          'plugins': ['wholerow', 'search']
                        });

    $("#sictree").on( 'dblclick', '.jstree-leaf', function(e) {
      var sicCode = $(e.target).parent().attr('id');
      $('#sicHelperModal').modal('toggle');
      $("#organization_employer_profile_attributes_sic_code").val(sicCode);
      $("#organization_employer_profile_attributes_sic_code").trigger('chosen:updated');
    });

    var to = false;
    $('#sic_search').keyup(function () {
      if(to) { clearTimeout(to); }

      to = setTimeout(function () {
        var v = $('#sic_search').val();
        $('#sictree').jstree(true).search(v);
      }, 250);
    });
  }
</script>
