<div>
  <div class="row no-buffer top-pd">
    <h4 class="title-inline">Broker Agencies</h4>

    <div class="pull-right broker_agencies_search">
      <div class="search-wp">
        <%= render 'shared/search', url: "/employers/employer_profiles/#{@employer_profile.id}/broker_agency", q: @q, remote: true, placeholder: 'Agency/Broker Name, NPN' %>
        <span class="pull-right">
          <a class="search-options" style="cursor: pointer;">Advanced Options</a>
        </span>
      </div>
      <%= hidden_field_tag "broker_search_url", employers_employer_profile_broker_agency_index_path(@employer_profile) %>

      <div id="advanced_options" style="display: none;">
          <div class="language_multi_select pull-right">
             <%= select_tag(:languages_spoken, options_from_collection_for_select(LanguageList::COMMON_LANGUAGES.sort_by {|lan| lan.common_name}, "iso_639_1", "common_name"), { id: 'broker_agency_language_select', multiple: "multiple" } ) %>
          </div>
          <div>
            <label class="pull-right">
              <%= check_box_tag :working_hours, {id: 'working_hours'} %> Evening/Weekend Availability
            </label>
          </div>
      </div>
    </div>
  </div>

<script type="text/javascript">
    $(function() {
      $(".search-options").click(function () {
        $("#advanced_options").toggle();
      });

      function searchAgencies(){
        var url = $("#broker_search_url").val();
        var weekend = $("#working_hours").is(":checked") ? "true" : "false";
        var languages = $("div.language_multi_select select").val();

        $.ajax({
          url: url,
          type: "GET",
          data : { 
            'q': $("div.search-wp input#q").val(),
            'working_hours': weekend, 
            'languages': languages,
            'advanced': 'true'
          }
        });
      }

      $("div.language_multi_select select").change(function(){
        searchAgencies();
      })

      $("#working_hours").change(function(){
        searchAgencies();
      })

      $('#broker_agency_language_select').selectric();

      $('#broker_agency_language_select').on('selectric-init', function(element){
        $('#broker_agency_language_select').selectric('destroy');
        $('#broker_agency_language_select').multiselect({
           nonSelectedText: 'Language(s) spoken',
           maxHeight: 300
        });
      });

    });
</script>

<style type="text/css">
 .language_multi_select .multiselect {
    border: none;
    font-size: 12px;
    line-height: 30px;
 }

 .language_multi_select .multiselect .caret {
    color: #bbb;
 }
</style>

<div class="row no-buffer" id="broker_agencies_listing">
<%= render "broker_agencies_listing" %>
</div>